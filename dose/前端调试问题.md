# 前端调试问题记录

## 🐛 当前问题

### 问题 1: `/api/user` 接口不存在
**错误**: `GET http://localhost:3000/api/user 404 (Not Found)`

**原因**: 后端没有提供 `/api/user` 接口

**解决方案**: ✅ 已修复 - 用户信息直接从 GitHub API 获取

---

### 问题 2: Token 格式不确定

**需要确认**: 后端期望的 Authorization 格式是什么？

#### 选项 A: Bearer Token (OAuth 2.0 标准)
```http
Authorization: Bearer ghp_xxxxxxxxxxxx
```

#### 选项 B: GitHub Token (GitHub API 标准)
```http
Authorization: token ghp_xxxxxxxxxxxx
```

**当前实现**:
- 调用 GitHub API: 使用 `token ghp_xxx` ✅
- 调用后端 API: 使用 `Bearer ghp_xxx` ❓

---

## 🔍 需要测试的接口

### 1. 获取仓库列表
```http
GET http://localhost:3000/api/repos
Authorization: Bearer ghp_xxxxxxxxxxxx
```

**测试步骤**:
1. 在前端登录页面输入 GitHub PAT
2. 点击"连接 GitHub"
3. 查看浏览器控制台的网络请求

**预期结果**: 返回仓库列表

---

### 2. 获取文件列表
```http
GET http://localhost:3000/api/files/:owner/:repo/:path
Authorization: Bearer ghp_xxxxxxxxxxxx
```

**测试步骤**:
1. 登录成功后
2. 点击一个仓库
3. 查看文件列表

**预期结果**: 返回文件列表

---

### 3. 上传文件
```http
PUT http://localhost:3000/api/file/:owner/:repo/:path
Authorization: Bearer ghp_xxxxxxxxxxxx
Content-Type: application/json

{
  "message": "Upload file via GitNetDisk",
  "content": "base64_encoded_content",
  "sha": "optional_if_updating"
}
```

**测试步骤**:
1. 进入仓库
2. 拖拽文件上传
3. 查看上传结果

**预期结果**: 文件上传成功

---

## 🔧 快速测试方法

### 使用 curl 测试后端接口

```bash
# 测试获取仓库列表
curl -X GET http://localhost:3000/api/repos \
  -H "Authorization: Bearer YOUR_GITHUB_TOKEN"

# 如果上面不行，试试这个
curl -X GET http://localhost:3000/api/repos \
  -H "Authorization: token YOUR_GITHUB_TOKEN"
```

---

## 📝 修改记录

### 2026-01-21

1. ✅ 修复 `/api/user` 404 错误
   - 改为直接调用 GitHub API
   - 使用正确的 `token` 格式

2. ⏳ 待确认后端 Token 格式
   - 需要测试 `/api/repos` 接口
   - 可能需要调整 `getHeaders()` 方法

---

## 🎯 下一步

1. **刷新浏览器页面**
2. **重新登录**
3. **查看控制台错误**
4. **告诉我新的错误信息**

如果 `/api/repos` 也返回 401 或 403，说明 Token 格式不对，需要调整。
