# 代理配置功能说明

## 功能概述
现在可以在前端设置界面配置网络代理，后端会通过代理访问 GitHub API。

## 使用步骤

### 1. 打开设置
点击右上角的设置按钮

### 2. 配置代理
在"网络代理配置"部分：
1. 启用"启用网络代理"开关
2. 输入代理服务器地址

### 3. 代理格式
支持以下格式：
- **HTTP 代理**: `http://127.0.0.1:7890`
- **SOCKS5 代理**: `socks5://127.0.0.1:1080`
- **带认证**: `http://username:password@127.0.0.1:7890`

### 4. 常见代理软件端口
- **Clash**: 7890 (HTTP), 7891 (SOCKS5)
- **V2Ray**: 10808 (SOCKS5), 10809 (HTTP)
- **Shadowsocks**: 1080 (SOCKS5)

### 5. 保存并重新登录
点击"保存设置"后，需要重新登录才能生效。

## 技术实现

### 前端
1. 在 `Settings.tsx` 中添加代理配置 UI
2. 保存到 localStorage: `gitnetdisk_proxy_url` 和 `gitnetdisk_use_proxy`
3. 在 `githubService.ts` 的 `getHeaders()` 中，将代理 URL 添加到请求头 `X-Proxy-URL`

### 后端
1. 在 `files.go` 中添加 `getProxyConfigFromHeader()` 函数
2. 从请求头 `X-Proxy-URL` 读取代理配置
3. 解析代理 URL（类型、主机、端口、认证）
4. 创建 GitHub 客户端时使用动态代理配置

## 已修改的文件

### 前端
- ✅ `git-web/components/Settings.tsx` - 添加代理配置 UI
- ✅ `git-web/services/githubService.ts` - 在请求头中传递代理配置

### 后端
- ✅ `git-net-disk/api/files.go` - 所有 4 个方法支持动态代理
- ⚠️ `git-net-disk/api/repos.go` - 需要更新（待完成）

## 待完成
需要更新 `repos.go` 中的两个方法：
1. `ListRepositories()` - 列出仓库
2. `CreateRepository()` - 创建仓库

让它们也从请求头读取代理配置，而不是使用 `h.proxyConfig`。

## 测试步骤
1. 启动本地代理软件（如 Clash）
2. 在设置中配置代理 URL
3. 保存设置并重新登录
4. 尝试访问仓库列表和上传文件
5. 检查后端日志，应该看到 `[INFO] Using proxy: http 127.0.0.1 7890`

## 注意事项
- 代理配置通过请求头传递，每个请求都会携带
- 如果代理 URL 无效，后端会忽略并使用直连
- 代理配置不会保存到后端，只在前端 localStorage 中
- 更改代理设置后需要重新登录才能生效
