# å‰ç«¯ä»£ç ä¿®æ”¹è¯´æ˜

## ğŸ¯ ä¿®æ”¹ç›®æ ‡

æ ¹æ®åç«¯æ–‡æ¡£çš„ä»£ç†æ¨¡å¼è®¾è®¡ï¼Œä¿®æ”¹å‰ç«¯ä»£ç ä»¥é€‚é…åç«¯çš„ `/api/proxy` æ¥å£ã€‚

## ğŸ“ ä¸»è¦ä¿®æ”¹

### 1. ä¾èµ–æ›´æ–° (`package.json`)

æ·»åŠ äº†ä»¥ä¸‹ä¾èµ–ï¼š
- `@octokit/core`: GitHub API å®¢æˆ·ç«¯ï¼ˆå¤‡ç”¨ï¼‰
- `zustand`: è½»é‡çº§çŠ¶æ€ç®¡ç†
- `react-dropzone`: æ–‡ä»¶æ‹–æ‹½ä¸Šä¼ 

### 2. çŠ¶æ€ç®¡ç† (`store/index.ts`)

åˆ›å»ºäº† Zustand store æ¥ç®¡ç†ä»£ç†é…ç½®ï¼š
```typescript
interface ProxyStore {
  proxyUrl: string | null;
  setProxyUrl: (url: string | null) => void;
}
```

### 3. GitHub æœåŠ¡é‡æ„ (`services/githubService.ts`)

**æ ¸å¿ƒæ”¹åŠ¨**ï¼š
- ç§»é™¤äº† `baseUrl` é…ç½®
- æ·»åŠ äº† `proxyUrl` å’Œ `useProxy` é…ç½®
- æ–°å¢ `buildUrl()` æ–¹æ³•ï¼Œæ ¹æ®é…ç½®å†³å®šæ˜¯å¦ä½¿ç”¨ä»£ç†

**è¯·æ±‚æµç¨‹**ï¼š

#### ç›´è¿æ¨¡å¼ï¼ˆuseProxy = falseï¼‰
```typescript
buildUrl('/user/repos')
// è¿”å›: https://api.github.com/user/repos
```

#### ä»£ç†æ¨¡å¼ï¼ˆuseProxy = trueï¼‰
```typescript
buildUrl('/user/repos')
// è¿”å›: /api/proxy?target=https%3A%2F%2Fapi.github.com%2Fuser%2Frepos

// è¯·æ±‚å¤´ä¼šåŒ…å«:
headers: {
  'x-proxy-url': 'http://127.0.0.1:7890'  // ç”¨æˆ·é…ç½®çš„ä»£ç†åœ°å€
}
```

### 4. è®¾ç½®é¡µé¢æ›´æ–° (`components/Settings.tsx`)

æ·»åŠ äº†ä»£ç†é…ç½®ç•Œé¢ï¼š
- **å¯ç”¨åç«¯ä»£ç†æœåŠ¡** å¼€å…³
- **ä»£ç†æœåŠ¡å™¨åœ°å€** è¾“å…¥æ¡†ï¼ˆæ”¯æŒ HTTP/SOCKS5ï¼‰
- é…ç½®è¯´æ˜å’Œç¤ºä¾‹

### 5. åº”ç”¨åˆå§‹åŒ– (`App.tsx`)

åœ¨åº”ç”¨å¯åŠ¨æ—¶ä» localStorage åŠ è½½ä»£ç†é…ç½®ï¼š
```typescript
const storedProxy = localStorage.getItem('gitnetdisk_proxy_url');
const storedUseProxy = localStorage.getItem('gitnetdisk_use_proxy') === 'true';

githubService.setProxyUrl(storedProxy);
githubService.setUseProxy(storedUseProxy);
```

## ğŸ”„ å·¥ä½œæµç¨‹

### ç”¨æˆ·é…ç½®ä»£ç†

1. ç”¨æˆ·æ‰“å¼€è®¾ç½®é¡µé¢
2. å¯ç”¨"å¯ç”¨åç«¯ä»£ç†æœåŠ¡"
3. è¾“å…¥ä»£ç†åœ°å€ï¼ˆå¦‚ `http://127.0.0.1:7890`ï¼‰
4. ä¿å­˜è®¾ç½®

### å‰ç«¯è¯·æ±‚æµç¨‹

```
ç”¨æˆ·æ“ä½œ â†’ githubService.getRepos()
         â†“
buildUrl('/user/repos')
         â†“
useProxy = true
         â†“
è¿”å›: /api/proxy?target=https://api.github.com/user/repos
         â†“
fetch(url, {
  headers: {
    'Authorization': 'token ghp_xxx',
    'x-proxy-url': 'http://127.0.0.1:7890'
  }
})
         â†“
åç«¯ä»£ç†æœåŠ¡æ¥æ”¶è¯·æ±‚
         â†“
ä½¿ç”¨ç”¨æˆ·é…ç½®çš„ä»£ç†è®¿é—® GitHub API
         â†“
è¿”å›ç»“æœç»™å‰ç«¯
```

## âœ… å…¼å®¹æ€§

- âœ… æ”¯æŒç›´è¿æ¨¡å¼ï¼ˆä¸ä½¿ç”¨ä»£ç†ï¼‰
- âœ… æ”¯æŒåç«¯ä»£ç†æ¨¡å¼
- âœ… å‘åå…¼å®¹æ—§çš„é…ç½®æ–¹å¼
- âœ… é…ç½®æŒä¹…åŒ–åˆ° localStorage

## ğŸš€ ä¸‹ä¸€æ­¥

1. å®‰è£…ä¾èµ–: `npm install`
2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨: `npm run dev`
3. åœ¨è®¾ç½®ä¸­é…ç½®ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
4. å¼€å§‹ä½¿ç”¨ï¼

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **åç«¯ API å¿…é¡»å®ç°**ï¼šå‰ç«¯ä¾èµ–åç«¯çš„ `/api/proxy` æ¥å£
2. **CORS é…ç½®**ï¼šåç«¯éœ€è¦æ­£ç¡®é…ç½® CORS ä¸­é—´ä»¶
3. **è¯·æ±‚å¤´ä¼ é€’**ï¼šåç«¯éœ€è¦è¯»å– `x-proxy-url` è¯·æ±‚å¤´
4. **é”™è¯¯å¤„ç†**ï¼šå‰ç«¯ä¼šæ˜¾ç¤ºåç«¯è¿”å›çš„é”™è¯¯ä¿¡æ¯

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [åç«¯å¼€å‘æ–‡æ¡£](../dose/åç«¯å¼€å‘æ–‡æ¡£.md) - æŸ¥çœ‹åç«¯ API è®¾è®¡
- [SETUP.md](./SETUP.md) - å‰ç«¯è®¾ç½®æŒ‡å—
