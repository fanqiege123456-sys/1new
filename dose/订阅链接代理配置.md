# 订阅链接代理配置功能

## 功能说明
现在 GitNetDisk 支持**直接使用 Clash/V2Ray 订阅链接**作为代理配置，无需安装额外的代理软件！

## 使用方法

### 1. 获取订阅链接
从你的代理服务商获取订阅链接，例如：
```
https://b.xsub.uk/s/6a862d4ba43e5175e1cac57c33d9ab82
```

### 2. 配置到 GitNetDisk
1. 打开 GitNetDisk 设置
2. 找到"网络代理配置"
3. 启用"启用网络代理"
4. 在"代理服务器地址"中输入你的订阅链接
5. 保存设置并重新登录

### 3. 自动解析
后端会自动：
- 下载订阅内容
- 解析 Clash YAML 或 Base64 格式
- 提取第一个可用的代理节点
- 使用该节点访问 GitHub API

## 支持的格式

### ✅ 支持
- **Clash YAML 格式**：包含 `proxies` 字段的 YAML 配置
- **Base64 编码**：包含多个代理节点的 Base64 编码列表
- **HTTP 代理节点**：从订阅中提取的 HTTP 代理
- **SOCKS5 代理节点**：从订阅中提取的 SOCKS5 代理

### ⚠️ 部分支持
- **Shadowsocks (SS)**：需要专门的客户端，暂不支持
- **VMess**：需要专门的客户端，暂不支持
- **Trojan**：需要专门的客户端，暂不支持

### 💡 建议
如果订阅中包含不支持的协议，后端会自动跳过并尝试使用下一个节点。建议使用包含 HTTP 或 SOCKS5 节点的订阅。

## 技术实现

### 后端新增文件
- `git-net-disk/internal/proxy/subscription.go` - 订阅解析模块

### 主要功能
1. **ParseSubscription()** - 解析订阅链接
2. **parseClashConfig()** - 解析 Clash YAML 格式
3. **parseBase64Nodes()** - 解析 Base64 编码的节点列表
4. **GetProxyFromSubscription()** - 带缓存的订阅解析（10分钟缓存）

### 工作流程
```
用户输入订阅链接
    ↓
前端保存到 localStorage
    ↓
请求时通过 X-Proxy-URL 头传递
    ↓
后端检测到订阅链接特征
    ↓
下载并解析订阅内容
    ↓
提取第一个可用节点
    ↓
使用该节点创建 HTTP 客户端
    ↓
访问 GitHub API
```

## 缓存机制
- 订阅内容会缓存 **10 分钟**
- 避免频繁请求订阅服务器
- 缓存失效后自动重新获取

## 使用示例

### 示例 1：使用订阅链接
```
代理地址：https://b.xsub.uk/s/6a862d4ba43e5175e1cac57c33d9ab82
```

后端日志：
```
[INFO] Using proxy from subscription: http proxy.example.com 8080
```

### 示例 2：使用本地代理
```
代理地址：http://127.0.0.1:7890
```

后端日志：
```
[INFO] Using proxy: http 127.0.0.1 7890
```

## 故障排除

### 问题 1：订阅解析失败
**症状**：后端日志显示 `[WARN] Failed to parse subscription`

**解决**：
1. 检查订阅链接是否有效
2. 尝试在浏览器中打开订阅链接，查看内容格式
3. 确认订阅包含 HTTP 或 SOCKS5 节点

### 问题 2：代理连接失败
**症状**：GitHub API 请求超时

**解决**：
1. 检查代理节点是否可用
2. 尝试更换订阅中的其他节点（目前自动使用第一个）
3. 检查网络连接

### 问题 3：不支持的协议
**症状**：后端日志显示 `unsupported proxy type`

**解决**：
- 使用包含 HTTP 或 SOCKS5 节点的订阅
- 或者使用本地代理软件（Clash）+ 本地端口的方式

## 优势

### 对比使用 Clash
| 方式 | 优点 | 缺点 |
|------|------|------|
| **订阅链接** | 无需额外软件<br/>配置简单<br/>适合打包成 APP | 仅支持 HTTP/SOCKS5<br/>功能相对简单 |
| **Clash + 本地端口** | 支持所有协议<br/>功能强大<br/>稳定性好 | 需要安装 Clash<br/>配置复杂<br/>不适合 APP |

## 适用场景
- ✅ 打包成独立 APP
- ✅ 无法安装代理软件的环境
- ✅ 需要简化配置流程
- ✅ 订阅包含 HTTP/SOCKS5 节点

## 注意事项
1. 订阅链接会被发送到后端服务器，请确保后端安全
2. 目前只使用订阅中的第一个可用节点
3. 不支持的协议会被自动跳过
4. 建议使用 HTTPS 订阅链接保证安全性
