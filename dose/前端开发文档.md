# GitNetDisk 前端开发文档

## 1. 技术栈

### 1.1 核心技术
- **框架**：React 18 + TypeScript
- **构建工具**：Vite
- **UI 库**：Ant Design 5 + Tailwind CSS
- **状态管理**：Zustand
- **文件操作**：react-dropzone
- **图标**：@ant-design/icons
- **GitHub SDK**：@octokit/core + @octokit/auth-oauth-app

### 1.2 依赖包
```bash
# 基础依赖
npm install react react-dom typescript

# 开发依赖
npm install -D vite @vitejs/plugin-react

# UI 依赖
npm install antd @ant-design/icons tailwindcss

# 功能依赖
npm install @octokit/core @octokit/auth-oauth-app react-dropzone zustand

# 工具依赖
npm install -D @types/react @types/react-dom
```

## 2. 项目结构

```
git-net-disk/frontend/
├── src/
│   ├── components/           # 组件
│   │   ├── Layout/           # 布局组件
│   │   │   ├── Header.tsx    # 顶部导航
│   │   │   ├── Sidebar.tsx   # 左侧边栏
│   │   │   └── MainContent.tsx # 主内容区
│   │   ├── Auth/             # 认证相关
│   │   │   └── LoginButton.tsx # 登录按钮
│   │   ├── Repo/             # 仓库相关
│   │   │   ├── RepoList.tsx  # 仓库列表
│   │   │   └── RepoCard.tsx  # 仓库卡片
│   │   ├── File/             # 文件相关
│   │   │   ├── FileExplorer.tsx # 文件浏览器
│   │   │   ├── FileList.tsx  # 文件列表
│   │   │   └── DropZoneUploader.tsx # 拖拽上传
│   │   └── Setting/          # 设置相关
│   │       └── ProxySetting.tsx # 代理设置
│   ├── pages/                # 页面
│   │   ├── Home.tsx          # 首页
│   │   ├── Callback.tsx      # OAuth 回调页
│   │   └── Settings.tsx      # 设置页
│   ├── store/                # 状态管理
│   │   ├── auth.ts           # 认证状态
│   │   ├── repo.ts           # 仓库状态
│   │   ├── file.ts           # 文件状态
│   │   └── proxy.ts          # 代理设置
│   ├── services/             # 服务
│   │   ├── github.ts         # GitHub API 封装
│   │   └── proxy.ts          # 代理服务
│   ├── utils/                # 工具函数
│   │   ├── storage.ts        # 存储工具
│   │   └── format.ts         # 格式化工具
│   ├── hooks/                # 自定义钩子
│   │   ├── useGitHub.ts      # GitHub API 钩子
│   │   └── useProxy.ts       # 代理钩子
│   ├── types/                # 类型定义
│   │   └── index.ts          # 全局类型
│   ├── App.tsx               # 应用根组件
│   ├── main.tsx              # 应用入口
│   └── vite-env.d.ts         # Vite 环境类型
├── public/                   # 静态资源
├── .gitignore                # Git 忽略文件
├── package.json              # 项目配置
├── tsconfig.json             # TypeScript 配置
├── tailwind.config.js        # Tailwind 配置
└── vite.config.ts            # Vite 配置
```

## 3. 核心功能实现

### 3.1 认证功能

#### 3.1.1 GitHub OAuth 登录

**登录流程**：
1. 生成 OAuth 授权 URL
2. 重定向到 GitHub 授权页
3. 用户授权后回调到应用
4. 交换授权码获取访问令牌
5. 存储令牌并跳转首页

**实现代码**：
```typescript
// src/services/github.ts
import { Octokit } from '@octokit/core';
import { createOAuthAppAuth } from '@octokit/auth-oauth-app';

const CLIENT_ID = import.meta.env.VITE_GITHUB_CLIENT_ID;
const CLIENT_SECRET = import.meta.env.VITE_GITHUB_CLIENT_SECRET;
const REDIRECT_URI = import.meta.env.VITE_REDIRECT_URI;

export function getAuthUrl() {
  const auth = createOAuthAppAuth({
    clientId: CLIENT_ID,
    clientSecret: CLIENT_SECRET,
  });

  const { url } = auth({ type: 'oauth-user', redirectUrl: REDIRECT_URI });
  return url;
}

export async function getAccessToken(code: string) {
  const auth = createOAuthAppAuth({
    clientId: CLIENT_ID,
    clientSecret: CLIENT_SECRET,
  });

  const { token } = await auth({ type: 'oauth-user', code, redirectUrl: REDIRECT_URI });
  return token;
}
```

#### 3.1.2 状态管理

```typescript
// src/store/auth.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AuthState {
  token: string | null;
  isLoggedIn: boolean;
  login: (token: string) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      token: null,
      isLoggedIn: false,
      login: (token) => set({ token, isLoggedIn: true }),
      logout: () => set({ token: null, isLoggedIn: false }),
    }),
    {
      name: 'gitnetdisk-auth',
    }
  )
);
```

### 3.2 仓库管理

#### 3.2.1 获取仓库列表

```typescript
// src/services/github.ts
export async function getRepos(token: string) {
  const octokit = new Octokit({ auth: token });
  const { data } = await octokit.request('GET /user/repos', {
    per_page: 100,
  });
  return data;
}
```

#### 3.2.2 新建仓库

```typescript
// src/services/github.ts
export async function createRepo(token: string, name: string, description: string, isPublic: boolean) {
  const octokit = new Octokit({ auth: token });
  const { data } = await octokit.request('POST /user/repos', {
    name,
    description,
    private: !isPublic,
  });
  return data;
}
```

### 3.3 文件操作

#### 3.3.1 获取文件列表

```typescript
// src/services/github.ts
export async function getFiles(token: string, owner: string, repo: string, path: string = '') {
  const octokit = new Octokit({ auth: token });
  const { data } = await octokit.request('GET /repos/{owner}/{repo}/contents/{path}', {
    owner,
    repo,
    path,
  });
  return data;
}
```

#### 3.3.2 上传文件

```typescript
// src/services/github.ts
export async function uploadFile(token: string, owner: string, repo: string, path: string, content: string, message: string) {
  const octokit = new Octokit({ auth: token });
  const encodedContent = btoa(unescape(encodeURIComponent(content)));
  
  const { data } = await octokit.request('PUT /repos/{owner}/{repo}/contents/{path}', {
    owner,
    repo,
    path,
    message,
    content: encodedContent,
  });
  return data;
}
```

### 3.4 代理设置

#### 3.4.1 代理配置

```typescript
// src/store/proxy.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface ProxyState {
  proxyUrl: string | null;
  setProxyUrl: (url: string | null) => void;
}

export const useProxyStore = create<ProxyState>()(
  persist(
    (set) => ({
      proxyUrl: null,
      setProxyUrl: (url) => set({ proxyUrl: url }),
    }),
    {
      name: 'gitnetdisk-proxy',
    }
  )
);
```

#### 3.4.2 代理请求

```typescript
// src/services/proxy.ts
import { useProxyStore } from '../store/proxy';

export function createProxyFetch() {
  const proxyUrl = useProxyStore.getState().proxyUrl;
  
  if (!proxyUrl) {
    return fetch;
  }
  
  return async (input: RequestInfo | URL, init?: RequestInit) => {
    const url = typeof input === 'string' ? input : input.url;
    const target = encodeURIComponent(url);
    
    return fetch(`/api/proxy?target=${target}`, {
      ...init,
      headers: {
        ...init?.headers,
        'x-proxy-url': proxyUrl,
      },
    });
  };
}
```

## 4. 组件实现

### 4.1 登录组件

```tsx
// src/components/Auth/LoginButton.tsx
import { Button } from 'antd';
import { GithubOutlined } from '@ant-design/icons';
import { getAuthUrl } from '../../services/github';

export default function LoginButton() {
  const handleLogin = () => {
    const authUrl = getAuthUrl();
    window.location.href = authUrl;
  };

  return (
    <Button
      type="primary"
      size="large"
      icon={<GithubOutlined />}
      onClick={handleLogin}
      className="flex items-center gap-2 px-6 py-3"
    >
      GitHub 登录
    </Button>
  );
}
```

### 4.2 仓库列表组件

```tsx
// src/components/Repo/RepoList.tsx
import { List, Empty, Spin } from 'antd';
import RepoCard from './RepoCard';
import { useRepoStore } from '../../store/repo';

export default function RepoList() {
  const { repos, loading } = useRepoStore();

  if (loading) {
    return <Spin size="large" tip="加载仓库中..." />;
  }

  if (repos.length === 0) {
    return <Empty description="暂无仓库" />;
  }

  return (
    <List
      grid={{ gutter: 16, column: 1 }}
      dataSource={repos}
      renderItem={(repo) => (
        <List.Item>
          <RepoCard repo={repo} />
        </List.Item>
      )}
    />
  );
}
```

### 4.3 文件浏览器组件

```tsx
// src/components/File/FileExplorer.tsx
import { useState, useEffect } from 'react';
import { Breadcrumb, Spin, Empty } from 'antd';
import FileList from './FileList';
import DropZoneUploader from './DropZoneUploader';
import { useFileStore } from '../../store/file';

export default function FileExplorer({ owner, repo }: { owner: string; repo: string }) {
  const [path, setPath] = useState('');
  const { files, loading, fetchFiles } = useFileStore();

  useEffect(() => {
    if (owner && repo) {
      fetchFiles(owner, repo, path);
    }
  }, [owner, repo, path]);

  const handlePathChange = (newPath: string) => {
    setPath(newPath);
  };

  const handleFileUpload = () => {
    fetchFiles(owner, repo, path);
  };

  const renderBreadcrumb = () => {
    const parts = path.split('/').filter(Boolean);
    const items = [
      { title: repo, onClick: () => setPath('') },
    ];

    let currentPath = '';
    parts.forEach((part, index) => {
      currentPath += part;
      items.push({
        title: part,
        onClick: () => setPath(currentPath),
      });
      currentPath += '/';
    });

    return <Breadcrumb items={items} />;
  };

  if (loading) {
    return <Spin size="large" tip="加载文件中..." />;
  }

  return (
    <div className="h-full flex flex-col">
      <div className="mb-4">{renderBreadcrumb()}</div>
      <DropZoneUploader
        owner={owner}
        repo={repo}
        path={path}
        onUploadComplete={handleFileUpload}
      >
        {files.length === 0 ? (
          <Empty description="该目录为空" />
        ) : (
          <FileList files={files} onPathChange={handlePathChange} />
        )}
      </DropZoneUploader>
    </div>
  );
}
```

### 4.4 代理设置组件

```tsx
// src/components/Setting/ProxySetting.tsx
import { Input, Button, message, Typography } from 'antd';
import { useState } from 'react';
import { useProxyStore } from '../../store/proxy';

const { Title, Text } = Typography;

export default function ProxySetting() {
  const { proxyUrl, setProxyUrl } = useProxyStore();
  const [value, setValue] = useState(proxyUrl || '');

  const handleSave = () => {
    const trimmedValue = value.trim();
    setProxyUrl(trimmedValue || null);
    message.success(trimmedValue ? '代理设置已保存' : '代理已禁用');
  };

  return (
    <div className="p-6 bg-gray-900 rounded-lg border border-gold-500">
      <Title level={4} className="text-gold-500 mb-4">代理设置</Title>
      <Text className="block text-gray-300 mb-4">
        设置 HTTP 或 SOCKS5 代理以加速 GitHub 访问
      </Text>
      
      <Input
        placeholder="例如：http://127.0.0.1:7890 或 socks5://127.0.0.1:1080"
        value={value}
        onChange={(e) => setValue(e.target.value)}
        className="mb-4 bg-gray-800 border-gold-500 text-white"
      />
      
      <Button
        type="primary"
        onClick={handleSave}
        className="bg-gradient-to-r from-gold-600 to-gold-400 border-gold-500 text-black font-bold"
      >
        保存设置
      </Button>
      
      <div className="mt-4 text-gray-400 text-sm">
        <p>支持格式：</p>
        <ul className="list-disc pl-5 mt-2">
          <li>http://127.0.0.1:7890</li>
          <li>socks5://127.0.0.1:1080</li>
          <li>http://user:pass@proxy.example.com:8080</li>
        </ul>
      </div>
    </div>
  );
}
```

## 5. 页面实现

### 5.1 首页

```tsx
// src/pages/Home.tsx
import { useEffect } from 'react';
import { Spin, Empty } from 'antd';
import { useAuthStore } from '../store/auth';
import { useRepoStore } from '../store/repo';
import Layout from '../components/Layout/Layout';
import RepoList from '../components/Repo/RepoList';
import FileExplorer from '../components/File/FileExplorer';

export default function Home() {
  const { isLoggedIn, token } = useAuthStore();
  const { repos, loading, selectedRepo, selectRepo, fetchRepos } = useRepoStore();

  useEffect(() => {
    if (isLoggedIn && token) {
      fetchRepos(token);
    }
  }, [isLoggedIn, token]);

  if (!isLoggedIn) {
    return (
      <Layout>
        <div className="flex items-center justify-center h-96">
          <Empty description="请先登录" />
        </div>
      </Layout>
    );
  }

  if (loading && repos.length === 0) {
    return (
      <Layout>
        <div className="flex items-center justify-center h-96">
          <Spin size="large" tip="加载中..." />
        </div>
      </Layout>
    );
  }

  return (
    <Layout>
      {selectedRepo ? (
        <FileExplorer 
          owner={selectedRepo.owner.login} 
          repo={selectedRepo.name} 
        />
      ) : (
        <RepoList />
      )}
    </Layout>
  );
}
```

### 5.2 回调页

```tsx
// src/pages/Callback.tsx
import { useEffect } from 'react';
import { Spin, Result, Typography } from 'antd';
import { useAuthStore } from '../store/auth';
import { getAccessToken } from '../services/github';

const { Title } = Typography;

export default function Callback() {
  const { login } = useAuthStore();
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const handleCallback = async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');
      
      if (code) {
        try {
          const token = await getAccessToken(code);
          login(token);
          window.location.href = '/';
        } catch (err) {
          setError('登录失败，请重试');
          setLoading(false);
        }
      } else {
        setError('缺少授权码');
        setLoading(false);
      }
    };

    handleCallback();
  }, [login]);

  if (loading) {
    return (
      <div className="flex flex-col items-center justify-center h-screen bg-gray-900">
        <Spin size="large" tip="正在处理授权..." />
      </div>
    );
  }

  if (error) {
    return (
      <div className="flex flex-col items-center justify-center h-screen bg-gray-900">
        <Result
          status="error"
          title={error}
          extra={
            <Button
              type="primary"
              onClick={() => window.location.href = '/'}
            >
              返回首页
            </Button>
          }
        />
      </div>
    );
  }

  return null;
}
```

### 5.3 设置页

```tsx
// src/pages/Settings.tsx
import { Layout } from 'antd';
import ProxySetting from '../components/Setting/ProxySetting';
import AppLayout from '../components/Layout/Layout';

const { Content } = Layout;

export default function Settings() {
  return (
    <AppLayout>
      <Content className="p-6">
        <div className="max-w-2xl mx-auto">
          <h1 className="text-2xl font-bold text-gold-500 mb-6">设置</h1>
          <ProxySetting />
        </div>
      </Content>
    </AppLayout>
  );
}
```

## 5. 样式设计

### 5.1 Tailwind 配置

```javascript
// tailwind.config.js
module.exports = {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        gold: {
          50: '#fef9c3',
          100: '#fef08a',
          200: '#fde047',
          300: '#facc15',
          400: '#eab308',
          500: '#ca8a04',
          600: '#a16207',
          700: '#854d0e',
          800: '#713f12',
          900: '#653e16',
        },
      },
      fontFamily: {
        playfair: ['Playfair Display', 'serif'],
        inter: ['Inter', 'sans-serif'],
      },
    },
  },
  plugins: [],
}
```

### 5.2 全局样式

```tsx
// src/main.tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
);
```

```css
/* src/index.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

body {
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: #0a0a0a;
  color: #ffffff;
}

code {
  font-family: 'JetBrains Mono', source-code-pro, Menlo, Monaco, Consolas, monospace;
}

/* 自定义滚动条 */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #1a1a1a;
}

::-webkit-scrollbar-thumb {
  background: #ca8a04;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #eab308;
}

/* 动画效果 */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in {
  animation: fadeIn 0.3s ease-out;
}
```

## 6. 部署配置

### 6.1 Vercel 配置

```json
// vercel.json
{
  "version": 2,
  "builds": [
    {
      "src": "frontend/package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "frontend/dist"
      }
    },
    {
      "src": "api/proxy.go",
      "use": "@vercel/go"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "/api/proxy.go"
    },
    {
      "src": "/(.*)",
      "dest": "/frontend/$1"
    }
  ]
}
```

### 6.2 环境变量

| 变量名 | 说明 | 示例值 |
|-------|------|--------|
| VITE_GITHUB_CLIENT_ID | GitHub OAuth 应用客户端 ID | 1234567890abcdef1234 |
| VITE_GITHUB_CLIENT_SECRET | GitHub OAuth 应用客户端密钥 | abcdef1234567890abcdef1234567890 |
| VITE_REDIRECT_URI | GitHub OAuth 回调地址 | http://localhost:5173/callback |

## 7. 开发流程

### 7.1 本地开发

```bash
# 启动前端开发服务器
cd frontend
npm run dev

# 构建前端
npm run build

# 预览构建结果
npm run preview
```

### 7.2 代码规范

1. **命名规范**：
   - 组件名：PascalCase
   - 变量名：camelCase
   - 常量名：UPPER_SNAKE_CASE
   - 文件命名：kebab-case 或 PascalCase（组件）

2. **代码风格**：
   - 使用 TypeScript 类型定义
   - 组件使用函数式组件和 Hooks
   - 状态管理使用 Zustand
   - 遵循 ESLint 和 Prettier 规范

### 7.3 测试建议

1. **单元测试**：使用 Jest 测试组件和工具函数
2. **集成测试**：测试 API 调用和状态管理
3. **端到端测试**：使用 Cypress 测试完整流程

## 8. 性能优化

1. **代码分割**：使用 React.lazy() 和 Suspense
2. **缓存策略**：缓存 API 响应和计算结果
3. **懒加载**：图片和组件懒加载
4. **防抖节流**：搜索和滚动事件优化
5. **虚拟滚动**：大文件列表使用虚拟滚动
6. **网络优化**：使用代理和合理的请求策略

## 9. 安全考虑

1. **OAuth 安全**：使用 HTTPS，保护客户端密钥
2. **Token 存储**：使用 secure 和 httpOnly 标志
3. **输入验证**：验证用户输入，防止注入攻击
4. **API 限流**：遵循 GitHub API 速率限制
5. **错误处理**：不暴露敏感错误信息给用户

## 10. 总结

GitNetDisk 前端开发采用现代化的 React + TypeScript 技术栈，结合 Ant Design 和 Tailwind CSS 实现美观的黑金奢华风格界面。通过 Zustand 管理状态，使用 Octokit 操作 GitHub API，支持代理设置以解决国内访问问题。

前端实现了完整的登录、仓库管理、文件浏览和上传功能，采用响应式设计，提供良好的用户体验。部署配置支持 Vercel 平台，方便快速上线。

通过这套前端开发方案，可以打造一个功能完整、性能优良、界面美观的 GitHub 网盘工具，让用户能够更便捷地使用 GitHub 进行文件存储和管理。